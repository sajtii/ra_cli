services:
  ra_cli:
    image: ghcr.io/sajtii/ra_cli:latest
    container_name: ra_cli
    restart: unless-stopped
    depends_on:
      discord:
        condition: service_healthy    # wait until discord passes its healthâ€‘check
    volumes:
      - tmp:/tmp
      - ./config.ini:/app/config.ini

  # https://hub.docker.com/r/kasmweb/discord
  discord:
    image: kasmweb/discord:1.16.0
    container_name: discord
    restart: unless-stopped
    ports:
      - 6901:6901/tcp
    environment:
      # username is 'kasm_user'
      VNC_PW: changeme
    shm_size: 512m
    # check if the discord desktop app is running
    healthcheck:
      test: ["CMD", "curl", "127.0.0.1:6463"]
      interval: 5s
      timeout: 2s
      retries: 6
      start_period: 10s
    volumes:
      - tmp:/tmp
      - kasm-user:/home/kasm-user

volumes:
  tmp:  # discord IPC socket is located in /tmp, so we share that dir to both containers
  kasm-user:  # persist home directory of kasm user